<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script>
      window.onload = function () {
        var dropZone = document.getElementById("drop_zone");
        dropZone.addEventListener('dragover', handleDragOver, false);
        dropZone.addEventListener('drop', handleFileSelect, false);
      }

      var host = location.origin.replace(/^http/, "ws");
      var context = window.location.pathname.substring(0, window.location.pathname.indexOf("/", 2));
      var url = host + context + "/Chat";
//      var url = ws://example.com/hoge
      var ws = new WebSocket(url);
      var iam = "Taro";

      ws.onopen = function () {
        ws.send(iam + " が接続しました");
      };

      ws.onmessage = function (message) {
        var tag = document.createElement("div");
        var message = document.createTextNode(message.data);
        tag.appendChild(message);
        document.getElementById("logs").appendChild(tag);
      };

      function postToServer() {
        ws.send(iam + "：" + document.getElementById("msg").value);
        document.getElementById("msg").value = "";
      }

      function closeConnect() {
        ws.send(iam + " が切断しました");
        ws.close();
      }

      function handleFileSelect(evt) {
        evt.stopPropagation();
        evt.preventDefault();

        var files = evt.dataTransfer.files; // FileList object.

        // files is a FileList of File objects. List some properties.
        var output = [];
        for (var i = 0, f; f = files[i]; i++) {
          output.push('<strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                  f.size, ' bytes, last modified: ',
                  f.lastModifiedDate.toLocaleDateString());
        }
        var tag = document.createElement("div");
        tag.innerHTML = output.join('');
        document.getElementById('logs').appendChild(tag);
      }

      function handleDragOver(evt) {
        evt.stopPropagation();
        evt.preventDefault();
        evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
      }
    </script>
  </head>
  <body>
    <div>
      <div>内容：<textarea id="msg"></textarea></div>
      <div id="drop_zone" style="
           width: 600px;
           height: 200px;
           border: gray thin solid;
           display: table-cell;
           text-align: center;
           vertical-align: middle;">
        スタンプ</div>
      <div>
        <button type="submit" onClick="postToServer()">話す</button>
        <button type="submit" onClick="closeConnect()">終了</button>
      </div>
    </div>
    <div id="logs"></div>
  </body>
</html>